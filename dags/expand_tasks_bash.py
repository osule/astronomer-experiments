"""
expand_tasks
DAG auto-generated by Astro Cloud IDE.
"""

from airflow.decorators import dag, task, task_group
from airflow.operators.bash import BashOperator


import pendulum

# Default arguments for the DAG
default_args = {
    "owner": "Oluwafemi Sule",
}


@dag(
    default_args=default_args,
    schedule_interval="0 0 * * *",  # Cron schedule
    start_date=pendulum.datetime(2024, 12, 4, tz="UTC"),
    catchup=False,
    owner_links={
        "Oluwafemi Sule": "https://cloud.astronomer.io/cm1eu47w413zr01nqex144eth/cloud-ide/cm1eu73d3140701nqx7ces5cz/cm49ulf811oxj01o6bu4tsaxp",
    },
)
def expand_tasks_bash():
    """A DAG demonstrating task group expansion."""

    @task_group(group_id="group1")
    def tg1(my_num):
        """Task group to process a number."""

        # Task to print the number
        print_num = BashOperator(
            task_id="print_num",
            bash_command='echo "Number is {{ params.my_num.resolve({"ti": ti, "run_id": run_id}) }}"',
            params={
                "my_num": my_num
            },  # Pass as an environment variable for dynamic expansion
        )

        # Task to add 42 to the number
        add_42 = BashOperator(
            task_id="add_42",
            bash_command='echo "Number + 42 is $(( {{ params.my_num.resolve({"ti": ti, "run_id": run_id}) }} + 42 ))"',
            params={"my_num": my_num},
        )

        # Set task dependencies
        print_num >> add_42

    # Expanding the task group with a list of input values
    tg1.expand(my_num=[19, 23, 42, 8, 7, 108])


# Instantiate the DAG
dag_obj = expand_tasks_bash()
